# SPDX-License-Identifier: Apache-2.0

---
all:

  vars:
    ansible_connection: ssh
    # Always connect as root
    ansible_user: root
    ansible_python_interpreter: /usr/bin/python3
    ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
    # Change according to your setup
    image_directory: ~/seapath/images/
    template_directory: ../templates
    # DNS server. Leave it empty to not set the DNS server
    dns_server:
    # Gateway IP Addr. The variable must be define but can be empty
    gateway_addr:

  children:

    # Specific to SFL, to retrieve images on the build machine
    build_machines:
      hosts:
        jean:
          ansible_host: 192.168.216.4
          # Change your username
          ansible_user: tsourdin
      vars:
        # Change according to your path
        src_image_path: ~/seapath/build/tmp/deploy/images

    pxe_machines:
      hosts:
        pxe_hypervisor:
          # Set IP address according to your setup
          # (IP set by the DHCP server in the PXE container)
          ansible_host: 192.168.203.95
          # The network interface to be used for the first boot,
          # will also be used by PTP
          network_interface: enp66s0f0
          # IP used by PTP and SSH
          static_ip_ptp: 192.168.202.4
          # Interface used to receive SV frames
          network_interface_iec: enp66s0f1
          # Corresponding IP address
          static_ip_iec: 192.168.203.4
          # Host image to flash
          image_path: "{{ image_directory }}/host_bios/host-bios.wic.gz"
          # The disk where the SEAPTAH distribution will be installed
          # In general: /dev/sda
          root_disk: /dev/sda

    hypervisors:
      hosts:
        seapath:
          # Set IP address according to your setup
          ansible_host: 192.168.202.4
          # The network interface that will be used by the hypervisor to
          # communicate across the network
          network_interface: enp66s0f0
          ip_addr: "{{ ansible_host }}"
          # Subnetwork. Optional variable, default is 24
          subnet: 24
          # dpdk_nic: "0000:42:00.1"
          ovs_ext_interface: enp66s0f1
          # unbind_pci_address:
          # - "0000:42:00.1" # Address of enp66s0f1
          custom_network:
            00-br0Host:
              - Match:
                  - Name: "br0Host"
              - Network:
                  - Address: "192.168.203.4"
      # hypervisors groupe variables
      vars:
        bootloader_config_file: /boot/syslinux.cfg
        ovs_bridges:
          - name: br0
            ports:
              - name: br0P0
                type: tap
              - name: br0P1
                type: tap
              - name: br0P2
                type: tap
              - name: br0P3
                type: tap
              - name: br0P4
                type: tap
              - name: br0Host
                type: internal
              - name: br0External
                type: system
                interface: "{{ ovs_ext_interface }}"
        vm_config: "{{ template_directory }}/vm/test.xml.j2"

    VMs:
      hosts:
        guest0:
          # On the VLAN used for SV, random mac address
          # The last byte of the IP address must be equal to
          # the last byte of the MAC address
          ansible_host: 192.168.203.15
          mac_address: 5E:FF:56:A2:AF:15
        guest1:
          ansible_host: 192.168.203.16
          mac_address: 5E:FF:56:A2:AF:16
      vars:
        ansible_user: root
        # ansible_become: true
        # ansible_become_method: sudo
        # ansible_become_flags: "-n -E"
        network_interface: enp0s2
        ip_addr: "{{ ansible_host }}"
        # Gateway IP Address used by the VMs.
        # Leave it empty to not set a gateway.
        gateway_addr:

    other_machines:
    vars:
      hosts:
        sender:
          ansible_host: 192.168.202.3
          ansible_user: sender
          interface_iec: ens5f1
          vlan_iec: 3
          mac_address_target: 5E:FF:56:A2:AF:15
        ptp:
          ansible_host: 192.168.202.2
          ansible_user: ptp
